<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>VCU Advisor Portal</title>
  <link rel="stylesheet" href="styles.css">
</head>

<body>

  <!-- ✅ Header with centered title and right-aligned login -->
  <header>
    <h1>VCU Advisor Portal</h1>
    <div class="header-right">
      <div id="userStatus">Logged in as: <span id="loggedInName">Not Logged In</span></div>
      <button id="loginBtn" onclick="handleLoginLogout()">Log In</button>
    </div>
  </header>

  <div class="container">
    <!-- ✅ Left Navigation Menu -->
    <nav>
      <ul>
        <li><a href="homescreen.html">Home</a></li>
        <li><a href="course-search.html">Course Search</a></li>
        <li><a href="ui_ux-loginscreen.html">Student Registration</a></li>
        <li><a href="instructor-schedule.html">Instructor Schedule</a></li>
        <li><a href="session-enrollment.html">Session Enrollment</a></li>
        <li><a href="advisor-portal.html" class="active">Advisor Portal</a></li>
      </ul>
    </nav>

    <!-- ✅ Main Advisor Content -->
    <main>
      <h2>Advisor Override Management</h2>

      <form onsubmit="event.preventDefault(); searchStudent();">
        <label for="studentSearch">Search Student (Name or ID):</label>
        <input type="text" id="studentSearch" placeholder="Enter student name or ID" required />
        <button type="submit">Search</button>
      </form>

      <div id="studentInfo" style="margin-top:20px;"></div>

      <div id="overrideSection" style="display:none; margin-top:20px;">
        <h3>Blocked Courses (Eligible for Override)</h3>
        <select id="blockedCourseSelect"></select>
        <button onclick="applyOverride()">Override &amp; Enroll</button>
      </div>

      <p id="status" style="margin-top:20px; font-weight:bold;"></p>
    </main>
  </div>

  <footer>
    <p>&copy; 2025 Course Registration System</p>
  </footer>

  <!-- ✅ Global Login Modal (Included Once Across All Pages) -->
  <div id="loginModal" class="modal">
    <div class="modal-content">
      <h3>Student Login</h3>
      <input type="text" id="loginUsername" placeholder="Enter Username" />
      <input type="password" id="loginPassword" placeholder="Enter Password" />
      <button onclick="login()">Log In</button>
      <button class="secondary-btn" onclick="closeLoginModal()">Cancel</button>
      <div id="loginMessage" class="modal-message"></div>
    </div>
  </div>

  <!-- ✅ Scripts -->
  <script src="students.js"></script>
  <script src="courses.js"></script>
  <script src="auth.js"></script>

  <script>
    let selectedStudent = null;

    // Search student by ID or name
    function searchStudent() {
      const query = document.getElementById("studentSearch").value.trim().toLowerCase();
      selectedStudent = students.find(s =>
        s.id.toLowerCase() === query || s.name.toLowerCase().includes(query)
      );

      const infoDiv = document.getElementById("studentInfo");
      const overrideSection = document.getElementById("overrideSection");
      const blockedSelect = document.getElementById("blockedCourseSelect");
      const status = document.getElementById("status");

      status.textContent = "";
      infoDiv.innerHTML = "";
      blockedSelect.innerHTML = "";
      overrideSection.style.display = "none";

      if (!selectedStudent) {
        infoDiv.innerHTML = "<p style='color:red;'>Student not found.</p>";
        return;
      }

      // ✅ Display student details
      infoDiv.innerHTML = `
        <p><strong>Name:</strong> ${selectedStudent.name}</p>
        <p><strong>ID:</strong> ${selectedStudent.id}</p>
        <p><strong>Enrolled Courses:</strong> ${selectedStudent.enrolledCourses.join(", ") || "None"}</p>
        <p><strong>Blocked Courses:</strong> ${selectedStudent.blockedCourses.join(", ") || "None"}</p>
      `;

      // ✅ Populate blocked courses for override
      if (selectedStudent.blockedCourses.length > 0) {
        selectedStudent.blockedCourses.forEach(course => {
          const option = document.createElement("option");
          option.value = course;
          option.textContent = course;
          blockedSelect.appendChild(option);
        });
        overrideSection.style.display = "block";
      }
    }

    // ✅ Apply override & enroll student
    function applyOverride() {
      const selectedCourse = document.getElementById("blockedCourseSelect").value;
      const status = document.getElementById("status");

      if (!selectedStudent || !selectedCourse) {
        status.textContent = "Please select a student and a course.";
        status.style.color = "red";
        return;
      }

      const message = overridePrerequisite(selectedStudent.id, selectedCourse);
      status.textContent = "✅ " + message;
      status.style.color = "green";

      // ✅ Refresh student info display after override
      searchStudent();
    }

    // ✅ Initialize login display (from auth.js)
    document.addEventListener("DOMContentLoaded", () => {
      initializeAuth();
    });
  </script>

</body>
</html>
